From 34dbca51a5fb5938db2e69ebb3318bbb182c2902 Mon Sep 17 00:00:00 2001
From: Chet Ramey <chet.ramey@case.edu>
Date: Fri, 1 Jun 2018 10:22:00 -0400
Subject: [PATCH] readline multi-key command re-read input fix

---
 lib/readline/readline.c | 4 ++--
 patchlevel.h            | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/lib/readline/readline.c b/lib/readline/readline.c
index e51df4f0..a05b35e5 100644
--- a/lib/readline/readline.c
+++ b/lib/readline/readline.c
@@ -1057,7 +1057,7 @@ _rl_subseq_result (r, map, key, got_subseq)
 	/* We probably shadowed a keymap, so keep going. */
 	r = _rl_dispatch (ANYOTHERKEY, m);
     }
-  else if (r && map[ANYOTHERKEY].function)
+  else if (r < 0 && map[ANYOTHERKEY].function)
     {
       /* We didn't match (r is probably -1), so return something to
 	 tell the caller that it should try ANYOTHERKEY for an
@@ -1069,7 +1069,7 @@ _rl_subseq_result (r, map, key, got_subseq)
       _rl_dispatching_keymap = map;
       return -2;
     }
-  else if (r && got_subseq)
+  else if (r < 0 && got_subseq)		/* XXX */
     {
       /* OK, back up the chain. */
       if (RL_ISSTATE (RL_STATE_MACROINPUT))
diff --git a/patchlevel.h b/patchlevel.h
index d87b0ba7..9be226c3 100644
--- a/patchlevel.h
+++ b/patchlevel.h
@@ -25,6 +25,6 @@
    regexp `^#define[ 	]*PATCHLEVEL', since that's what support/mkversion.sh
    looks for to find the patch level (for the sccs version string). */
 
-#define PATCHLEVEL 21
+#define PATCHLEVEL 22
 
 #endif /* _PATCHLEVEL_H_ */
-- 
2.14.4

